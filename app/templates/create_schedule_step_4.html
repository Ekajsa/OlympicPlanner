{% extends "base_template.html" %}
{% set active_page = "schedules" %}

{% block head %}
<script src="jquery-3.5.1.min.js"></script>
{% endblock %}

{%  block content12 %}
    <div class="content-section">
        <h1>Congratulations!</h1>
            <div class="container-fluid">
                <p> Here is a filtered version of the main schedule. If you like it as it is, you can
                    copy all of it to your personal schedule. If you want, you can fine tune the main schedule with
                    filters. Then you can either copy the whole main schedule to your personal schedule, or drag and
                    drop to add events from the main schedule to your personal schedule. </p>
            </div>
    </div>
    {% for schedule in schedules %}
        {{ schedule[0] | safe }}
        <div class="base-schedule">
            {{ schedule[1] | safe }}
        </div>
    {% endfor %}
    {% for personal_schedule in personal_schedules %}
        <div class="personal-schedule">
            {{ personal_schedule[1] | safe }}
        </div>
    {% endfor %}
{% endblock %}

{% block scripts %}
    const clonableDivs = document.querySelectorAll(".clone-me");
    clonableDivs.forEach(div => {
        div.addEventListener("click", moveIt);
    });


    function moveIt(e) {
        // Get the div that we clicked
        let targetDiv = e.target;
        // Get the cell hosting the div in the from table
        let targetCell = targetDiv.parentElement;
        // Get the id of the row containing the div
        let parentRowId = targetDiv.parentElement.parentElement.id;
        // Get the id of the row in the destination table
        let destinationRowId = 't' + parentRowId.substring(1);

        // Get the current cells rowspan
        let rowspan = targetCell.rowSpan;

        // Get the destination table
        let toTable = document.getElementById("to-table");

        // Remove the div from the origianl table
        targetDiv.parentElement.removeChild(targetDiv);

        // Iterate over the destination table row by row
        for (let row of toTable.rows) {
            // If we have found our destination row
            if(row.id === destinationRowId){
                // Add the div in the correct column
                row.cells[targetCell.cellIndex].appendChild(targetDiv);
                // Add the rowspan we want to this column. If no rospan
                // was given, the value will be 1
                row.cells[targetCell.cellIndex].rowSpan = rowspan;
                // If we have a rowsapn we need to delete the td's for as many
                // rows as the span is
                if(rowspan > 1) {
                    // Get the current row index
                    let rowIndex = targetCell.parentElement.rowIndex;
                    // and the column index
                    let cellIndex = targetCell.cellIndex;
                    // For each row below the one we inserted the div in
                    // we can now delete the td's
                    for(let i = 1; i < rowspan; i++) {
                        let row = toTable.rows[rowIndex + i];
                        row.deleteCell(cellIndex);
                    }
                }
            }
        }
    }
{% endblock %}



{#{% block content4 %}#}
{#    <div>#}
{#        <table>#}
{#        <tr>#}
{#            <th></th>#}
{#            {% for column in priority_columns %}#}
{#                <th>{{ column }}</th>#}
{#            {% endfor %}#}
{#        </tr>#}
{#        {% for row in personal_schedule %}#}
{#            <tr>#}
{#                <td>{{ time_slots[loop.index - 1] }} </td>#}
{#                {% for cell in row %}#}
{#                    <td>{{ cell }}</td>#}
{#                {% endfor %}#}
{#            </tr>#}
{#        {% endfor %}#}
{#    </table>#}
{#    </div>#}
{#{% endblock %}#}


{% block scripts %}
{% endblock %}
